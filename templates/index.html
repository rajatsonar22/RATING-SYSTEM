<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Ratings</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', sans-serif;
            text-align: center; 
            background-color: black; 
            color: white; 
        }
        .team-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 20px; 
        }
        .team { 
            width: 700px;  
            height: 100px;
            margin: 30px 0; /* Increased space between teams */
            padding: 20px; 
            background: #3498db; 
            color: black; 
            border-radius: 10px; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }
        .team-description { 
            color: black; 
            font-size: 16px; 
            text-align: left; 
            flex-grow: 1;
            margin-left: 20px; /* Shifted text to the left */
        }
        .rating-container { 
            display: flex; 
            justify-content: center; 
            align-items: center;
            gap: 10px;
        }
        .stars span { font-size: 30px; cursor: pointer; color: gray; }
        .stars span:hover, .stars span.active { color: gold; }

        /* Style for check votes section */
        .check-votes-container {
            margin-top: 30px;
            padding: 20px;
            background: #2ecc71;
            border-radius: 10px;
            width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        input, button {
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: none;
        }
        input { width: 80%; }
        button { background: #2980b9; color: white; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Select a Team to Rate</h1>
    <div class="team-container"></div>

    <!-- Check Votes Section -->
    <div class="check-votes-container">
        <h2>Check Total Votes</h2>
        <input type="password" id="adminKey" placeholder="Enter secret key">
        <button onclick="checkVotes()">Check</button>
        <p id="voteCount"></p>
    </div>

    <script>
        const topics = [
            "PPT Presentation",
            "AI Deepfake Voice Detection",
            "Intelligent Job Classification and Notifications Using Placement Data",
            "Health Coach: Your Personal Health Companion",
            "Intelligent Learner Management System",
            "Shopsphere (ParkPay)",
            "Currency Detection for Visually Impaired",
            "Remote Interview",
            "Hospital Management System",
            "HUD Integrated Helmet",
            "Deepfake Detection System",
            "Healthy Bites",
            "Doc Tech",
            "Custom Operating System for Effective Learning",
            "Eco-system",
            "QURA: The Signware"
        ];

        const container = document.querySelector(".team-container");

        // Generate teams dynamically
        topics.forEach((topic, index) => {
            let div = document.createElement("div");
            div.className = "team";
            div.innerHTML = `
                <div class="team-description">
                    <h2>${topic}</h2>
                    <div>Your description here</div>
                </div>
                <div class="rating-container" id="ratingContainer-${index}">
                    <div class="stars" data-team="${topic}">
                        <span data-value="1">★</span>
                        <span data-value="2">★</span>
                        <span data-value="3">★</span>
                        <span data-value="4">★</span>
                        <span data-value="5">★</span>
                    </div>
                </div>
            `;
            div.onclick = () => rateTeam(topic);
            container.appendChild(div);
        });

        // Handle Star Selection and Rating Submission
        function rateTeam(teamName) {
            const stars = document.querySelectorAll(`[data-team="${teamName}"] span`);
            let selectedRating = 0;

            stars.forEach(star => {
                star.onclick = function () {
                    selectedRating = this.getAttribute("data-value");
                    stars.forEach(s => s.classList.remove("active"));
                    for (let i = 0; i < selectedRating; i++) {
                        stars[i].classList.add("active");
                    }

                    // Submit Rating to Backend
                    fetch("/rate", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ team: teamName, rating: selectedRating })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                    })
                    .catch(error => console.error("Error:", error));
                };
            });
        }

        // Check Votes Function
        function checkVotes() {
            const key = document.getElementById("adminKey").value;

            fetch("/check_votes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ key: key })
            })
            .then(response => response.json())
            .then(data => {
                if (data.total_votes !== undefined) {
                    document.getElementById("voteCount").innerText = `Total Votes: ${data.total_votes}`;
                } else {
                    document.getElementById("voteCount").innerText = "Invalid Key!";
                }
            })
            .catch(error => console.error("Error:", error));
        }
    </script>

</body>
</html>
